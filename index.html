<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ö–ª–∏–∫–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background:#1a1a2e; color:#fff; font-family:Arial,sans-serif; margin:0; padding:20px; user-select:none }
        .game-container { max-width:400px; margin:0 auto; text-align:center }
        .stats { display:flex;justify-content:space-between;margin-bottom:20px;background:rgba(255,255,255,0.1);padding:15px;border-radius:10px }
        .crystal-button {width:200px;height:200px;background:linear-gradient(45deg,#7b68ee,#9370db);border:none;border-radius:50%;color:#fff;font-size:60px;cursor:pointer;transition:.2s;margin:20px 0;box-shadow:0 10px 20px rgba(123,104,238,0.3)}
        .crystal-button:active {transform:scale(.95); box-shadow: 0 5px 10px rgba(123,104,238,0.5)}
        .energy-bar{width:100%;height:20px;background:rgba(255,255,255,0.2);border-radius:10px;overflow:hidden;margin:10px 0}
        .energy-fill{height:100%;background:linear-gradient(90deg,#00ff88,#00cc66);transition:.3s}
        .level-progress{width:100%;height:15px;background:rgba(255,255,255,0.2);border-radius:8px;overflow:hidden;margin:10px 0}
        .level-fill{height:100%;background:linear-gradient(90deg,#ffd700,#ffed4e);transition:.3s}
        .upgrade-button{background:#0088cc;color:#fff;border:none;padding:10px 20px;border-radius:8px;margin:5px;cursor:pointer;font-size:14px}
        .upgrade-button:disabled{opacity:.5;cursor:not-allowed}
        .floating-text {position:absolute;font-size:20px;font-weight:bold;color:#ffd700;pointer-events:none;animation:floatUp 1s ease-out forwards;}
        @keyframes floatUp {0%{opacity:1;transform:translateY(0);}100%{opacity:0;transform:translateY(-50px);}}
        .menu-buttons { display:flex;flex-wrap:wrap;gap:10px;margin-top:20px;justify-content:center }
        .menu-screen{display:none;animation:fadeIn .3s}
        @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
        .back-button{background:#666;color:white;border:none;padding:10px 20px;border-radius:8px;margin-bottom:20px;cursor:pointer}
    </style>
</head>
<body>
    <div id="main-screen" class="game-container">
        <h1>üåå –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ö–ª–∏–∫–µ—Ä</h1>
        <div class="stats">
            <div><div>üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã</div><div id="balance">0</div></div>
            <div><div>‚≠ê –£—Ä–æ–≤–µ–Ω—å</div><div id="level">1</div></div>
            <div><div>üî• –ó–∞ –∫–ª–∏–∫</div><div id="tap-power">1</div></div>
        </div>
        <div>‚ö° –≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/<span id="max-energy">1000</span></div>
        <div class="energy-bar"><div id="energy-fill" class="energy-fill" style="width:100%"></div></div>
        <div>üéØ –û–ø—ã—Ç: <span id="experience">0</span>/<span id="exp-needed">100</span></div>
        <div class="level-progress"><div id="level-fill" class="level-fill" style="width:0%"></div></div>
        <button id="crystal-btn" class="crystal-button">üíé</button>
        <div class="menu-buttons">
            <button class="upgrade-button" onclick="showScreen('upgrades')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="upgrade-button" onclick="showScreen('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="upgrade-button" onclick="showScreen('leaderboard')">üèÜ –¢–æ–ø</button>
            <button class="upgrade-button" onclick="showScreen('achievements')">üéñÔ∏è –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        </div>
    </div>
    <div id="upgrades-screen" class="menu-screen"><button class="back-button" onclick="showScreen('main')">‚Üê –ù–∞–∑–∞–¥</button><h2>üõí –ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</h2><div id="upgrades-list"></div></div>
    <div id="profile-screen" class="menu-screen"><button class="back-button" onclick="showScreen('main')">‚Üê –ù–∞–∑–∞–¥</button><h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2><div id="profile-info"></div></div>
    <div id="leaderboard-screen" class="menu-screen"><button class="back-button" onclick="showScreen('main')">‚Üê –ù–∞–∑–∞–¥</button><h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2><div id="leaderboard-list"></div></div>
    <div id="achievements-screen" class="menu-screen"><button class="back-button" onclick="showScreen('main')">‚Üê –ù–∞–∑–∞–¥</button><h2>üéñÔ∏è –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2><div id="achievements-list"></div></div>
    <script>
        const tg = window.Telegram && window.Telegram.WebApp;
        tg && tg.expand();
        const user = tg && tg.initDataUnsafe && tg.initDataUnsafe.user;
        const userId = user?.id || Math.random().toString();
        const userName = user?.first_name || user?.username || '–ö–æ—Å–º–æ–Ω–∞–≤—Ç';
        let gameData = {
            balance: 0,
            level: 1,
            experience: 0,
            energy: 1000,
            maxEnergy: 1000,
            tapPower: 1,
            totalTaps: 0,
            upgrades: {drill: 0, energy: 0, auto: 0, recovery: 0, station: 0},
            achievements: []
        };
        const savedData = localStorage.getItem('cosmic-clicker-' + userId);
        if (savedData) gameData = {...gameData, ...JSON.parse(savedData)};
        const upgrades = {
            drill: {name: '‚õèÔ∏è –ú–æ—â–Ω–æ—Å—Ç—å –±—É—Ä–∞',description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –∑–∞ —Ç–∞–ø',baseCost: 10,multiplier: 1.5},
            energy: {name: 'üîã –Å–º–∫–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏',description: '–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏',baseCost: 50, multiplier: 1.6},
            auto: {name: 'ü§ñ –ê–≤—Ç–æ-–º–∞–π–Ω–µ—Ä—ã', description: '–î–æ–±—ã–≤–∞—é—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –ø–∞—Å—Å–∏–≤–Ω–æ', baseCost: 100, multiplier: 1.8},
            recovery: {name: '‚ö° –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ',description: '–£—Å–∫–æ—Ä—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏', baseCost: 200, multiplier: 2.0},
            station: {name: 'üõ∏ –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è',description: '–í—Å—ë –Ω–µ–º–Ω–æ–≥–æ –ª—É—á—à–µ',baseCost: 1000,multiplier: 2.2}
        };

        function getUpgradeCost(type, level) { return Math.floor(upgrades[type].baseCost * Math.pow(upgrades[type].multiplier, level)); }
        function getTapPower() { return 1 + gameData.upgrades.drill * 2 + Math.floor(gameData.upgrades.station * .5);}
        function getMaxEnergy() { return 1000 + gameData.upgrades.energy * 500 + gameData.upgrades.station*200;}
        function getEnergyRecovery() { return 1 + gameData.upgrades.recovery * 0.5 + gameData.upgrades.station * 0.2;}
        function getAutoIncome() { return gameData.upgrades.auto * (2 + gameData.upgrades.station);}
        function getExpNeeded() { return Math.floor(100 * Math.pow(1.15, gameData.level - 1)); }
        function updateUI() {
            document.getElementById('balance').textContent = gameData.balance;
            document.getElementById('level').textContent = gameData.level;
            document.getElementById('tap-power').textContent = getTapPower();
            document.getElementById('energy').textContent = Math.floor(gameData.energy);
            document.getElementById('max-energy').textContent = getMaxEnergy();
            document.getElementById('experience').textContent = gameData.experience;
            document.getElementById('exp-needed').textContent = getExpNeeded();
            document.getElementById('energy-fill').style.width = (gameData.energy/getMaxEnergy()*100)+'%';
            document.getElementById('level-fill').style.width = (gameData.experience/getExpNeeded()*100)+'%';
        }

        function tap() {
    if (gameData.energy <= 0) return;
    const power = getTapPower();
    gameData.balance += power;
    gameData.energy = Math.max(0, gameData.energy - 1);
    gameData.experience += 1;
    gameData.totalTaps++;

    if (gameData.experience >= getExpNeeded()) {
        gameData.level++;
        gameData.experience -= getExpNeeded();
        showFloatingText('+–£–†–û–í–ï–ù–¨!', '#ffd700');
        // –Ω–∏–∫–∞–∫–∏—Ö –∞—á–∏–≤–æ–∫!
    }
    showFloatingText('+' + power, '#00ff88');
    updateUI();
    saveGame();
}
// –ò –≤—Å—ë ‚Äî –Ω–∏–∫–∞–∫–æ–π tg.sendData, –Ω–∏–∫–∞–∫–æ–π checkAchievements, –Ω–∏–∫–∞–∫–æ–π unlockAchievement


        function showFloatingText(text, color) {
            const floatingText = document.createElement('div');
            floatingText.className = 'floating-text';
            floatingText.textContent = text;
            floatingText.style.color = color;
            floatingText.style.left = (Math.random() * 200 + 100)+'px';
            floatingText.style.top = '300px';
            document.body.appendChild(floatingText);
            setTimeout(() => { 
                if (floatingText.parentNode) floatingText.parentNode.removeChild(floatingText); 
            }, 1000);
        }

        function buyUpgrade(type) {
            const cost = getUpgradeCost(type, gameData.upgrades[type]);
            if (gameData.balance >= cost) {
                gameData.balance -= cost;
                gameData.upgrades[type]++;
                updateUI(); renderUpgrades(); saveGame();
                // –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "–ü–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ"
                if (!gameData.achievements.includes('first_upgrade')) unlockAchievement('first_upgrade');
                checkComboAchievements();
            }
        }

        function showScreen(screen) {
            document.querySelectorAll('.game-container, .menu-screen').forEach(el=>el.style.display='none');
            if (screen === 'main') document.getElementById('main-screen').style.display='block';
            else {
                document.getElementById(screen+'-screen').style.display='block';
                if (screen==='upgrades') renderUpgrades();
                if (screen==='profile') renderProfile();
                if (screen==='leaderboard') renderLeaderboard();
                if (screen==='achievements') renderAchievements();
            }
        }

        function renderUpgrades() {
            const c = document.getElementById('upgrades-list'); c.innerHTML = '';
            Object.keys(upgrades).forEach(type => {
                const u = upgrades[type], l=gameData.upgrades[type], cost=getUpgradeCost(type,l), canBuy=gameData.balance>=cost;
                const d = document.createElement('div');
                d.style.cssText = 'background:rgba(255,255,255,0.1);padding:15px;margin:10px 0;border-radius:10px;';
                d.innerHTML = `<div style="font-weight:bold;">${u.name}</div>
                    <div style="font-size:14px;opacity:.8;">${u.description}</div>
                    <div style="margin:10px 0;">–£—Ä–æ–≤–µ–Ω—å: ${l}</div>
                    <button onclick="buyUpgrade('${type}')" style="background:${canBuy?'#00aa00':'#666'};color:white;border:none;padding:10px 20px;border-radius:5px;cursor:${canBuy?'pointer':'not-allowed'};" ${!canBuy?'disabled':''}>
                        –ö—É–ø–∏—Ç—å –∑–∞ ${cost} üíé
                    </button>`;
                c.appendChild(d);
            });
        }
        function renderProfile() {
            document.getElementById('profile-info').innerHTML =
                `<div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;">
                    <h3>üëã –ü—Ä–∏–≤–µ—Ç, ${userName}!</h3>
                    <p>üíé –í—Å–µ–≥–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤: ${gameData.balance}</p>
                    <p>‚≠ê –£—Ä–æ–≤–µ–Ω—å: ${gameData.level}</p>
                    <p>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤: ${gameData.totalTaps}</p>
                    <p>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π: ${gameData.achievements.length}</p>
                    <p>ü§ñ –ê–≤—Ç–æ-–¥–æ—Ö–æ–¥/—á–∞—Å: ${getAutoIncome()*3600}</p>
                </div>`;
        }
        function renderLeaderboard() {
            const c = document.getElementById('leaderboard-list');
            const leaders=[
                {name:'CosmicMiner',balance:1500000,level:45},
                {name:'StarHarvester',balance:1200000,level:42},
                {name:'GalaxyDriller',balance:980000,level:38},
                {name:userName,balance:gameData.balance,level:gameData.level}
            ].sort((a,b)=>b.balance-a.balance);
            c.innerHTML = leaders.map((p,i)=>
                `<div style="background:rgba(255,255,255,0.1);padding:15px;margin:10px 0;border-radius:10px;${p.name===userName?'border:2px solid #ffd700;':''}">
                    <div style="font-weight:bold;">${i+1}. ${p.name}</div>
                    <div>üíé ${p.balance} | ‚≠ê ${p.level}</div>
                </div>`
            ).join('');
        }
        const achievementsList=[
            {id:'first_tap',name:'–ü–µ—Ä–≤—ã–π —Ç–∞–ø',desc:'–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ç–∞–ø',check:()=>gameData.totalTaps>=1},
            {id:'hundred_taps',name:'–°–æ—Ç–Ω—è —Ç–∞–ø–æ–≤',desc:'–°–¥–µ–ª–∞—Ç—å 100 —Ç–∞–ø–æ–≤',check:()=>gameData.totalTaps>=100},
            {id:'first_upgrade',name:'–ü–µ—Ä–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ',desc:'–ö—É–ø–∏—Ç—å –ª—é–±–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ',check:()=>Object.values(gameData.upgrades).some(v=>v>0)},
            {id:'level_10',name:'–û–ø—ã—Ç–Ω—ã–π –º–∞–π–Ω–µ—Ä',desc:'–î–æ—Å—Ç–∏—á—å 10 —É—Ä–æ–≤–Ω—è',check:()=>gameData.level>=10},
            {id:'rich',name:'–ë–æ–≥–∞—á',desc:'–ù–∞–∫–æ–ø–∏—Ç—å 10,000 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤',check:()=>gameData.balance>=10000}
        ];
        function checkComboAchievements() {
            if (!gameData.achievements.includes('hundred_taps') && gameData.totalTaps >= 100) {
                unlockAchievement('hundred_taps');
            }
            if (!gameData.achievements.includes('first_upgrade') && Object.values(gameData.upgrades).some(v=>v>0)) {
                unlockAchievement('first_upgrade');
            }
            if (!gameData.achievements.includes('level_10') && gameData.level >= 10) {
                unlockAchievement('level_10');
            }
            if (!gameData.achievements.includes('rich') && gameData.balance >= 10000) {
                unlockAchievement('rich');
            }
        }
        function unlockAchievement(id) {
            const achievement = achievementsList.find(a => a.id === id);
            if (!achievement) return;
            if (!gameData.achievements.includes(id)) {
                gameData.achievements.push(id);
                showFloatingText('üèÜ '+achievement.name,'#ffd700');
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram WebApp —Ç–æ–ª—å–∫–æ –û–î–ò–ù —Ä–∞–∑ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è!
                if (tg && tg.sendData) {
                    tg.sendData(JSON.stringify({type:'achievement',achievement:achievement.name}));
                }
            }
        }
        function renderAchievements() {
            document.getElementById('achievements-list').innerHTML =
                achievementsList.map(a=>{
                    const unlocked = gameData.achievements.includes(a.id);
                    return `<div style="background:rgba(255,255,255,0.1);padding:15px;margin:10px 0;border-radius:10px;opacity:${unlocked?'1':'0.5'};">
                        <div style="font-weight:bold;">${unlocked?'üèÜ':'üîí'} ${a.name}</div>
                        <div style="font-size:14px;opacity:.8;">${a.desc}</div>
                    </div>`;
            }).join('');
        }
        function saveGame() { localStorage.setItem('cosmic-clicker-'+userId, JSON.stringify(gameData)); }
        setInterval(()=>{
            const recovery = getEnergyRecovery();
            gameData.energy = Math.min(getMaxEnergy(), gameData.energy+recovery);
            const autoIncome = getAutoIncome();
            if (autoIncome>0) gameData.balance += autoIncome;
            updateUI(); saveGame();
        },1000);
        if (tg) {
            tg.MainButton.setText('üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å');
            tg.MainButton.show();
            tg.MainButton.onClick(()=>{ tg.sendData(JSON.stringify({type:'save_progress',userId,data:gameData})); });
            tg.ready();
        }
        document.getElementById('crystal-btn').addEventListener('click', tap);
        updateUI();
    </script>
</body>
</html>

